% =======================================
%           Document constructor
% =======================================

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                Packages               %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{graphicx}
\usepackage{tikz}
\usepackage{pgfplots}
\usepackage{xstring}
\usepackage{xcolor}
\usepackage{makecell}
\usepackage{wrapfig}
\usepackage{esvect}
\usepackage[most]{tcolorbox}
\usepackage{listings}
\usepackage{geometry}
\usepackage{blindtext}
\usepackage{hyperref}
\usepackage[font=small,labelfont=bf]{caption}
\usepackage{physics}
\usepackage[normalem]{ulem}
\usepackage[table]{colortbl}
\usepackage{tikz}
\usepackage{titletoc}
\usepackage{fancyhdr}
\usepackage[type={CC}, modifier={by-nc-nd}, version={4.0}]{doclicense}
\usepackage[font = footnotesize]{caption}
\usepackage[explicit]{titlesec}
\usepackage{afterpage}
\usepackage{anyfontsize}
\usepackage{xfrac}
\usepackage{nicefrac}
\usepackage{longtable}
\usepackage[outline]{contour}
\usepackage{everypage}
\usepackage{calc}
\usepackage{minitoc}
\usepackage{etoolbox}

\usepackage[backend=bibtex]{biblatex}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%              Custom Fonts             %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\usepackage[default]{fouriernc}
\usepackage{lato}
\usepackage[T1]{fontenc}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%             Custom Colors             %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\definecolor{theoryLINE}{HTML}{6682f1}
\definecolor{practiceLINE}{HTML}{fecf54} % ffcb54

\definecolor{lemmaBG}{HTML}{b1e0e8}
\definecolor{lemmaTitleBG}{HTML}{c1e5eb}

\definecolor{theoremBG}{HTML}{9adfdd}
\definecolor{theoremTitleBG}{HTML}{a8e3e1}

\definecolor{definitionBG}{HTML}{97bcea}
\definecolor{definitionTitleBG}{HTML}{97cbea}

\definecolor{corollaryBG}{HTML}{6da2ec}
\definecolor{corollaryTitleBG}{HTML}{89b8fa}

\definecolor{proofBG}{HTML}{d8c3f0}
\definecolor{proofTitleBG}{HTML}{ceb2ed}

\definecolor{exerciseBG}{HTML}{faf0bc} % fcdf9c
\definecolor{exerciseTitleBG}{HTML}{fff2af} % ffd87e

\definecolor{exampleBG}{HTML}{ffd39a} % fcdf9c
\definecolor{exampleTitleBG}{HTML}{ffe3be} % ffd87e

\definecolor{solutionBG}{HTML}{c4f8e1} % - a5e3fa -  
\definecolor{solutionTitleBG}{HTML}{9cffd3} % - beedfe - 

\definecolor{remarkBG}{HTML}{ee9595} % - a5e3fa - 
\definecolor{remarkLINE}{HTML}{9d1830} % - 41b9e4 - 
\definecolor{remarkTitleBG}{HTML}{feb7b7} % - beedfe - 

\definecolor{curiosityBG}{HTML}{97e687} % - a5e3fa
\definecolor{curiosityLINE}{HTML}{43a82e} % - 41b9e4
\definecolor{curiosityTitleBG}{HTML}{c0f5b5} % - beedfe

\definecolor{codeBG}{HTML}{353738} % - a5e3fa - 
\definecolor{codeLINE}{HTML}{24292b} % - 41b9e4 - 
\definecolor{codeTitleBG}{HTML}{5b5f61} % - beedfe -

\definecolor{gray1}{HTML}{3a3a3a}
\definecolor{gray2}{HTML}{565656}
\definecolor{gray3}{HTML}{787878}
\definecolor{gray4}{HTML}{a1a1a1}
\definecolor{gray5}{HTML}{cacaca} % 044454

\definecolor{extLinksColor}{HTML}{4eacc3} % 3b0e79 
\definecolor{intLinksColor}{HTML}{0e1179} %

\definecolor{definiton_green}{HTML}{3ACE59}
\definecolor{custom_cyan}{HTML}{19A6B4}

\definecolor{codeBG}{HTML}{353738} % - a5e3fa - 
\definecolor{codeLINE}{HTML}{24292b} % - 41b9e4 - 
\definecolor{codeTitleBG}{HTML}{5b5f61} % - beedfe - 

\definecolor{backcolour}{HTML}{313640}

\definecolor{codeCOMMENT}{HTML}{98C379}
\definecolor{codeKEY}{HTML}{C678DD}
\definecolor{codeFUNC}{HTML}{61AFEF}
\definecolor{codeVALUES}{HTML}{E5C07B}
\definecolor{codeOPERATORS}{HTML}{56B6C2}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%           Packages commands           %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\hypersetup{
    colorlinks=true,
    linkcolor=intLinksColor,
    anchorcolor=intLinksColor,
    urlcolor=extLinksColor,}

\geometry{
    a4paper,
    total={170mm,257mm},
    left=25mm,
    right=25mm,
    top=20mm,
    bottom=25mm
    }

\contourlength{3pt}

\renewcommand\cellgape{\Gape[8pt]}
\renewcommand{\cellalign}{cc}
\pgfplotsset{width=10cm,compat=1.9}

\fboxsep=10pt

\lstdefinestyle{mystyle}{
    backgroundcolor=\color{backcolour},
    commentstyle=\color{codeCOMMENT},
    keywordstyle=\color{codeKEY},
    numberstyle=\tiny\color{codeVALUES},
    stringstyle=\color{codeCOMMENT},
    basicstyle=\ttfamily\linespread{1}\footnotesize\color{white},
    breakatwhitespace=false,
    breaklines=true,
    captionpos=b,
    keepspaces=true,
    numbers=left,
    numbersep=5pt,
    showspaces=false,
    showstringspaces=false,
    showtabs=false,
    tabsize=4,
}

\lstset{style=mystyle}

\renewcommand{\chaptermark}[1]{%
\markboth{\thechapter.\ #1}{}}

\fancypagestyle{fancy}{%
    \fancyhf{}
    \fancyfoot[C]{\footnotesize Made by \href{https://www.leonardobiason.com}{Leonardo Biason} \copyright 2022-2023 - Please refer to the \hyperref[chap:introduction]{introduction} if you want to share this material \normalsize}
    \fancyhead[R]{\nouppercase{\rightmark}}
    \fancyhead[L]{\small Page \large \textbf{\thepage} \normalsize}
    \renewcommand{\footrulewidth}{0.4pt} % Line at the footer visible
}

% Below is the footer setting for chapter pages %

\fancypagestyle{plain}{%
    \fancyhf{}
    \fancyfoot[C]{\footnotesize Made by \href{https://www.leonardobiason.com}{Leonardo Biason} \copyright 2022-2023 - Please refer to the \hyperref[chap:introduction]{introduction} if you want to share this material \normalsize}
    \fancyhead[R]{\nouppercase{\rightmark}}
    \fancyhead[L]{\small Page \large \textbf{\thepage} \normalsize}
    \renewcommand{\footrulewidth}{0.4pt}% Line at the footer visible
}

\captionsetup{justification = centering}

% Normally one line should be 15.5 in a tikzpicture

\titlespacing{\chapter}{0pt}{0pt}{60pt}

\titleformat{\chapter}[display]{\filright\normalfont\huge\bfseries\color{white}}{
\makebox[0pt][l]{%          %
    \raisebox{-\totalheight}[-50pt][0pt]{% 
    \begin{center}
        \begin{tikzpicture}[remember picture, overlay, transform shape]
            \draw[fill = doc, color = doc] (15.45, 0.81) circle (80pt);
            \draw[fill = doc, color = doc] (-8, -2) rectangle (15.45, 6);
            \draw[fill = doc, color = doc] (15.45, 0.8) rectangle (19, 6);
            \draw[fill = doc, color = doc] (-0.2, -1.05) circle (1pt) node [anchor = south] {\color{white}\fontsize{120pt}{120pt}\selectfont C};
            \draw[color = white, thick] (1.25, -0.2) -- (3.35, -0.2);
            \draw[color = white, thick] (4.25, -0.2) -- (9, -0.2);
        \end{tikzpicture}
    \end{center}
    }
}\quad \quad \fontsize{50pt}{50pt}\selectfont hapter \thechapter}{0pt}{\quad \quad #1} % #1 stands for the Chapter name

\titleformat{\section}[block]
{\hspace{-75pt}\filright\normalfont\fontsize{20pt}{20pt}\selectfont\bfseries}{
\makebox[0pt][l]{%          %
    \raisebox{-\totalheight}[-50pt][0pt]{% 
    \begin{center}
        \begin{tikzpicture}[remember picture, overlay, transform shape]
            \draw[fill = doc, color = doc] (-0.5, -0.1) rectangle (2.2, 0.6);
        \end{tikzpicture}
    \end{center}
    }
}
\textcolor{white}{\thesection}
}{60pt-\widthof{\thesection}}{#1} % #1 stands for the Section name

\titleformat{\subsection}[block]
{\hspace{-75pt}\filright\normalfont\fontsize{18pt}{18pt}\selectfont\bfseries}{
\textcolor{doc}{\thesubsection}
\makebox[0pt][l]{%          %
    \raisebox{-\totalheight}[-50pt][0pt]{% 
    \begin{center}
        \begin{tikzpicture}[remember picture, overlay, transform shape]
            \draw[fill = doc, color = doc] (-2.175, 0.025) rectangle (0.525, 0.395);
            \draw[fill = doc, color = doc] (0.525, 0.21) circle (5.25pt);
            \begin{scope}
                \clip (-2.175, 0.025) rectangle (0.525, 0.395);
                \node[color=white, line width = 0pt] at (-1.007, 0.21) {\fontsize{18pt}{18pt}\selectfont\bfseries\thesubsection};
            \end{scope}
        \end{tikzpicture}
    \end{center}
    }
}
}{62pt-\widthof{\thesubsection}}{#1} % #1 stands for the Section name

%\bibliographystyle{plain}
%\addbibresource{refs.bib}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%             Boxes section             %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newtcolorbox{lemma}[1]{enhanced,
    boxsep=0.25ex,
    title=\textbf{\fontfamily{ppl}\selectfont{Lemma {#1}:}},
    coltitle=black,
    arc=0mm,
    rounded corners=all,
    borderline west={5pt}{-0.5pt}{theoryLINE},
    colback=lemmaBG,
    colframe=lemmaBG,
    enhanced,
    breakable,
    skin first=enhanced,
    skin middle=enhanced,
    skin last=enhanced,
    attach boxed title to top left ={
        yshift=-\tcboxedtitleheight/2,
        yshifttext=-\tcboxedtitleheight/2
    },
    halign title=left,
    boxed title style={
        colback=lemmaTitleBG,
        borderline west={5pt}{-0.5pt}{theoryLINE},
    },
    %overlay={
    %  \foreach \n in {north east,north west,south east,south west}
    %    {%
    %    \draw [theoryLINE, fill=theoryLINE] (frame.\n) circle (2pt);
    %    };
    %}
}  % DONE

\newtcolorbox{theorem}[1]{enhanced,
    boxsep=0.25ex,
    title=\fontfamily{ppl}\selectfont{\textbf{Theorem:} {#1}},
    coltitle=black,
    arc=0mm,
    rounded corners=all,
    borderline west={5pt}{-0.5pt}{theoryLINE},
    colback=theoremBG,
    colframe=theoremBG,
    enhanced,
    breakable,
    skin first=enhanced,
    skin middle=enhanced,
    skin last=enhanced,
    attach boxed title to top left ={
        yshift=-\tcboxedtitleheight/2,
        yshifttext=-\tcboxedtitleheight/2
    },
    halign title=left,
    boxed title style={%
        colback=theoremTitleBG,
        borderline west={5pt}{-0.5pt}{theoryLINE},
    },
}  % DONE

\newtcolorbox{definition}[1]{enhanced,
    boxsep=0.25ex,
    title=\fontfamily{ppl}\selectfont{\textbf{Definition:} {#1}},
    coltitle=black,
    arc=0mm,
    rounded corners=all,
    borderline west={5pt}{-0.5pt}{theoryLINE},
    colback=definitionBG,
    colframe=definitionBG,
    enhanced,
    breakable,
    skin first=enhanced,
    skin middle=enhanced,
    skin last=enhanced,
    attach boxed title to top left ={
        yshift=-\tcboxedtitleheight/2,
        yshifttext=-\tcboxedtitleheight/2
    },
    halign title=left,
    boxed title style={
        colback=definitionTitleBG,
        borderline west={5pt}{-0.5pt}{theoryLINE},
    },
}  % DONE

\newtcolorbox{proof}[1]{enhanced,
    enlarge top initially by=-6mm,
    boxsep=0.25ex,
    arc=0mm,
    title=\fontfamily{ppl}\selectfont{\textbf{Proof of the {#1}}},
    coltitle=black,
    rounded corners=all,
    borderline west={5pt}{-0.5pt}{theoryLINE},
    colback=proofBG,
    colframe=proofBG,
    enhanced,
    breakable,
    skin first=enhanced,
    skin middle=enhanced,
    skin last=enhanced,
    attach boxed title to top left ={
        yshift=-\tcboxedtitleheight/2,
        yshifttext=-\tcboxedtitleheight/2
    },
    halign title=left,
    boxed title style={
        colback=proofTitleBG,
        colframe=proofBG,
        borderline west={5pt}{-0.5pt}{theoryLINE},
    },
}  % DONE

\newtcolorbox{corollary}[1]{enhanced,
    boxsep=0.25ex,
    title=\fontfamily{ppl}\selectfont{\textbf{Corollary:} {#1}},
    coltitle=black,
    arc=0mm,
    rounded corners=all,
    borderline west={5pt}{-0.5pt}{theoryLINE},
    colback=corollaryBG,
    colframe=corollaryBG,
    enhanced,
    breakable,
    skin first=enhanced,
    skin middle=enhanced,
    skin last=enhanced,
    attach boxed title to top left ={
        yshift=-\tcboxedtitleheight/2,
        yshifttext=-\tcboxedtitleheight/2
    },
    halign title=left,
    boxed title style={%
        colback=corollaryTitleBG,
        borderline west={5pt}{-0.5pt}{theoryLINE},
    },
}  % DONE

\newtcolorbox{exercise}[1]{enhanced,
    boxsep=0.25ex,
    title=\fontfamily{ppl}\selectfont{\textbf{Exercise {#1}}},
    coltitle=black,
    arc=0mm,
    rounded corners=all,
    borderline west={5pt}{-0.5pt}{practiceLINE},
    colback=exerciseBG,
    colframe=exerciseBG,
    enhanced,
    breakable,
    skin first=enhanced,
    skin middle=enhanced,
    skin last=enhanced,
    attach boxed title to top left ={
        yshift=-\tcboxedtitleheight/2,
        yshifttext=-\tcboxedtitleheight/2
    },
    halign title=left,
    boxed title style={%
        colback=exerciseTitleBG,
        borderline west={5pt}{-0.5pt}{practiceLINE},
    },
}  % DONE

\newtcolorbox{example}[1]{enhanced,
    boxsep=0.25ex,
    title=\fontfamily{ppl}\selectfont{\textbf{Example {#1}}},
    coltitle=black,
    arc=0mm,
    rounded corners=all,
    borderline west={5pt}{-0.5pt}{practiceLINE},
    colback=exampleBG,
    colframe=exampleBG,
    enhanced,
    breakable,
    skin first=enhanced,
    skin middle=enhanced,
    skin last=enhanced,
    attach boxed title to top left ={
        yshift=-\tcboxedtitleheight/2,
        yshifttext=-\tcboxedtitleheight/2
    },
    halign title=left,
    boxed title style={%
        colback=exampleTitleBG,
        borderline west={5pt}{-0.5pt}{practiceLINE},
    },
}  % DONE

\newtcolorbox{solution}[1]{enhanced,
    enlarge top initially by=-6mm,
    boxsep=0.25ex,
    title=\fontfamily{ppl}\selectfont{\textbf{Solution to Exercise {#1}}},
    coltitle=black,
    arc=1mm,
    rounded corners=all,
    borderline west={5pt}{-0.5pt}{practiceLINE},
    colback=solutionBG,
    colframe=solutionBG,
    enhanced,
    breakable,
    skin first=enhanced,
    skin middle=enhanced,
    skin last=enhanced,
    attach boxed title to top left ={
        yshift=-\tcboxedtitleheight/2,
        yshifttext=-\tcboxedtitleheight/2
    },
    halign title=left,
    boxed title style={%
        colback=solutionTitleBG,
        borderline west={5pt}{-0.5pt}{practiceLINE},
    },
}  % DONE

\newtcolorbox{remark}[1]{enhanced,
    boxsep=0.25ex,
    title=\fontfamily{ppl}\selectfont{\textbf{Remark:} {#1}},
    coltitle=black,
    arc=0mm,
    rounded corners=all,
    borderline west={5pt}{-0.5pt}{remarkLINE},
    colback=remarkBG,
    colframe=remarkBG,
    enhanced,
    breakable,
    skin first=enhanced,
    skin middle=enhanced,
    skin last=enhanced,
    attach boxed title to top left ={
        yshift=-\tcboxedtitleheight/2,
        yshifttext=-\tcboxedtitleheight/2
    },
    halign title=left,
    boxed title style={%
        colback=remarkTitleBG,
        borderline west={5pt}{-0.5pt}{remarkLINE},
    },
}  % DONE

\newtcolorbox{curiosity}[1]{enhanced,
    boxsep=0.25ex,
    title=\fontfamily{ppl}\selectfont{\textbf{Curiosity:} {#1}},
    coltitle=black,
    arc=0mm,
    rounded corners=all,
    borderline west={5pt}{-0.5pt}{curiosityLINE},
    colback=curiosityBG,
    colframe=curiosityBG,
    enhanced,
    breakable,
    skin first=enhanced,
    skin middle=enhanced,
    skin last=enhanced,
    attach boxed title to top left ={
        yshift=-\tcboxedtitleheight/2,
        yshifttext=-\tcboxedtitleheight/2
    },
    halign title=left,
    boxed title style={%
        colback=curiosityTitleBG,
        borderline west={5pt}{-0.5pt}{curiosityLINE},
    },
}  % DONE

\newtcolorbox{codebox}[1]{enhanced,
    boxsep=0.10ex,
    title=\textbf{{#1}},
    coltitle=white,
    arc=0mm,
    rounded corners=all,
    borderline west={1pt}{-0.5pt}{codeLINE},
    borderline east={1pt}{-0.5pt}{codeLINE},
    borderline south={1pt}{-0.5pt}{codeLINE},
    borderline north={1pt}{-0.5pt}{codeLINE},
    colback=backcolour,
    colframe=backcolour,
    enhanced,
    breakable,
    skin first=enhanced,
    skin middle=enhanced,
    skin last=enhanced,
    attach boxed title to top left ={
        xshift=5pt,
        yshift=-\tcboxedtitleheight/2,
        yshifttext=-\tcboxedtitleheight/2
    },
    halign title=left,
    boxed title style={%
        colback=codeTitleBG,
    },
}

\newtcolorbox{summary}{enhanced,
    %boxsep=0.25ex,
    arc=0mm,
    rounded corners=all,
    borderline west={5pt}{-0.5pt}{doc},
    colback=doc!80,
    colframe=doc,
    enhanced,
    breakable,
    skin first=enhanced,
    skin middle=enhanced,
    skin last=enhanced,
    enlarge left by=-2.5cm,
    enlarge top by=-0.9cm,
    width=0.45\linewidth,
    attach boxed title to top left ={
        yshift=-\tcboxedtitleheight/2,
        yshifttext=-\tcboxedtitleheight/2
    },
    halign title=left,
    boxed title style={
        colback=doc,
        borderline west={5pt}{-0.5pt}{doc},
    },
}  % DONE

\newtcolorbox{myCodeBox}{enhanced,
    borderline west={5pt}{-0.5pt}{codeLINE},
    colback=backcolour,
    colframe=backcolour,
    %enlarge left by=-5pt,
    %enlarge right by=30pt,
    enhanced,
    breakable,
    skin first=enhanced,
    skin middle=enhanced,
    skin last=enhanced,
}  % DONE

\newtcolorbox{question}{enhanced,
    borderline west={5pt}{-0.5pt}{doc},
    colback=doc!10,
    colframe=white,
    %enlarge left by=-5pt,
    %enlarge right by=30pt,
    enhanced,
    breakable,
    skin first=enhanced,
    skin middle=enhanced,
    skin last=enhanced,
}  % DONE

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%            Custom commands            %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%==== Fonts commands ====%
\newcommand{\italic}[1]{\textit{#1}}
\newcommand{\titleFont}[1]{{\fontfamily{lato}\selectfont{#1}}}
\newcommand{\code}[1]{{\fontfamily{qcr}\selectfont{#1}}}

%=== Chapter commands ===%
\newcommand{\summarybox}[1]{
\makebox[0pt][l]{
    \centering
    \raisebox{-\totalheight}[35pt][0pt]{%     
        \begin{tikzpicture}[remember picture, overlay]
            \draw[fill=doc, color=doc] (-3.25, 0) rectangle (3.965, 3);
            \draw[fill=doc, color=doc] (0.28, 0.75) circle (0.1pt) node [anchor = south] {\fontsize{22pt}{22pt}\selectfont \textcolor{white}{\textbf{Summary}}};
            \draw[thick, color=white, fill=white] (-2.15, 0.95) -- (1.6, 0.95);
            \draw[thick, color=white, fill=white] (1.9, 0.95) -- (2.65, 0.95);
            \draw[fill=doc, color=doc] (3.9, 1) rectangle (6, 3);
            \draw[fill=white, color=white] (6, 0.95) circle (57.5pt);
        \end{tikzpicture}
    }
}
\begin{summary}
#1
\end{summary}

}

%=== Geometry commands ===%
\newcommand{\summarygeom}{\newgeometry{
    a4paper,
    total={170mm,257mm},
    left=0mm,
    right=0mm,
    top=20mm,
    bottom=25mm
    }}

\newcommand{\normalgeom}{\newgeometry{
    a4paper,
    total={170mm,257mm},
    left=25mm,
    right=25mm,
    top=20mm,
    bottom=25mm
    }}

\newcommand\aty[2]{\AddThispageHook{\raisebox{\dimexpr\PageTopMargin+\voffset-#1\relax}{#2}}}

\newcommand\atx[2]{\AddThispageHook{\smash{\hspace*{\dimexpr-\PageLeftMargin-\hoffset+#1\relax}{#2}}}}

\newcommand\atxy[3]{\AddThispageHook{\smash{\hspace*{\dimexpr-\PageLeftMargin-\hoffset+#1\relax}\raisebox{\dimexpr\PageTopMargin+\voffset-#2\relax}{#3}}}}

\makeatletter
\def\@hspace#1{\begingroup\setlength\dimen@{#1}\hskip\dimen@\endgroup}
\makeatother

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%           Table of contents           %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\definecolor{doc}{HTML}{6e000d}
\contentsmargin{0cm}
\titlecontents{chapter}[3.7pc]
{\addvspace{30pt}%
	\begin{tikzpicture}[remember picture, overlay]%
		\draw[fill=doc!90,draw=doc!90] (-7, -0.1) rectangle (-0.12, 0.5);%-0.9
        \draw[fill=white!60,draw=white!60] (-0.6, -0.15) rectangle (-0.10, 0.55);
		\pgftext[left,x=-3.5cm,y=0.2cm]{\color{white}\Large\sc\bfseries Chapter\ \color{doc}\Large\sc\bfseries \thecontentslabel};%
	\end{tikzpicture}\color{doc!90} $\quad \blacktriangleright \;$ \large\sc\bfseries}%
{}
{}
{\;\titlerule\;\large\sc\bfseries Page \thecontentspage
	\begin{tikzpicture}[remember picture, overlay]
		\draw[fill=doc!90,draw=doc!90] (2pt,0) rectangle (4,0.1pt);
	\end{tikzpicture}}%
 
\titlecontents{section}[3.7pc]
{\addvspace{2pt}}
{\contentslabel[\thecontentslabel]{2pc}}
{}
{\hfill\small \thecontentspage}
[]

\titlecontents{subsection}[6.5pc]
{\addvspace{1.75pt}}
{\contentslabel[\thecontentslabel]{2.7pc}}
{}
{\hfill\small \thecontentspage}
[]

\makeatletter
\renewcommand{\tableofcontents}{%
	\chapter*{%
	  \vspace*{-30\p@}%
	  \begin{tikzpicture}[remember picture, overlay]%
		  \pgftext[right,x=15cm,y=0.2cm]{\color{doc!90} \Huge\sc\bfseries \contentsname};%
		  \draw[fill=doc!90,draw=doc!90] (13,-.75) rectangle (20,1);%
		  \clip (13,-.75) rectangle (20,1);
		  \pgftext[right,x=15cm,y=0.2cm]{\color{white} \Huge\sc\bfseries \contentsname};%
	  \end{tikzpicture}}%
	\@starttoc{toc}}
\makeatother
