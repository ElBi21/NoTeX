% =======================================
%           Document constructor
% =======================================

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                Packages               %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{graphicx}
\usepackage{tikz}
\usepackage{pgfplots}
\usepackage{xstring}
\usepackage{xcolor}
\usepackage{makecell}
\usepackage{wrapfig}
\usepackage{esvect}
\usepackage[most]{tcolorbox}
\usepackage{listings}
\usepackage{geometry}   %[tmargin=2cm,rmargin=1in,lmargin=1in,margin=0.85in,bmargin=2cm,footskip=.2in]
\usepackage{blindtext}
\usepackage{hyperref}
\usepackage[font=small,labelfont=bf]{caption}
\usepackage{physics}
\usepackage[normalem]{ulem}
\usepackage[table]{colortbl}
\usepackage{tikz}
\usepackage{titletoc}
\usepackage{fancyhdr}
\usepackage[type={CC}, modifier={by-nc-nd}, version={4.0},]{doclicense}
\usepackage[font = footnotesize]{caption}
\usepackage{titlesec}
\usepackage{afterpage}
\usepackage{anyfontsize}
\usepackage{xfrac}
\usepackage{nicefrac}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%              Custom Fonts             %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\usepackage[default]{fouriernc}
\usepackage{lato}
\usepackage[T1]{fontenc}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%             Custom Colors             %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\definecolor{theoryLINE}{HTML}{6682f1}
\definecolor{practiceLINE}{HTML}{fecf54} % ffcb54

\definecolor{lemmaBG}{HTML}{b1e0e8}
\definecolor{lemmaTitleBG}{HTML}{c1e5eb}

\definecolor{theoremBG}{HTML}{9adfdd}
\definecolor{theoremTitleBG}{HTML}{a8e3e1}

\definecolor{definitionBG}{HTML}{97bcea}
\definecolor{definitionTitleBG}{HTML}{97cbea}

\definecolor{corollaryBG}{HTML}{6da2ec}
\definecolor{corollaryTitleBG}{HTML}{89b8fa}

\definecolor{proofBG}{HTML}{d8c3f0}
\definecolor{proofTitleBG}{HTML}{ceb2ed}

\definecolor{exerciseBG}{HTML}{faf0bc} % fcdf9c
\definecolor{exerciseTitleBG}{HTML}{fff2af} % ffd87e

\definecolor{exampleBG}{HTML}{ffd39a} % fcdf9c
\definecolor{exampleTitleBG}{HTML}{ffe3be} % ffd87e

\definecolor{solutionBG}{HTML}{c4f8e1} % - a5e3fa -  
\definecolor{solutionTitleBG}{HTML}{9cffd3} % - beedfe - 

\definecolor{remarkBG}{HTML}{ee9595} % - a5e3fa - 
\definecolor{remarkLINE}{HTML}{9d1830} % - 41b9e4 - 
\definecolor{remarkTitleBG}{HTML}{feb7b7} % - beedfe - 

\definecolor{curiosityBG}{HTML}{97e687} % - a5e3fa - 
\definecolor{curiosityLINE}{HTML}{43a82e} % - 41b9e4 - 
\definecolor{curiosityTitleBG}{HTML}{c0f5b5} % - beedfe - 

\definecolor{codeBG}{HTML}{353738} % - a5e3fa - 
\definecolor{codeLINE}{HTML}{24292b} % - 41b9e4 - 
\definecolor{codeTitleBG}{HTML}{5b5f61} % - beedfe -

\definecolor{gray1}{HTML}{3a3a3a}
\definecolor{gray2}{HTML}{565656}
\definecolor{gray3}{HTML}{787878}
\definecolor{gray4}{HTML}{a1a1a1}
\definecolor{gray5}{HTML}{cacaca} % 044454

\definecolor{linksColor}{HTML}{4eacc3}

\definecolor{definiton_green}{HTML}{3ACE59}
\definecolor{custom_cyan}{HTML}{19A6B4}

\definecolor{codeBG}{HTML}{353738} % - a5e3fa - 
\definecolor{codeLINE}{HTML}{24292b} % - 41b9e4 - 
\definecolor{codeTitleBG}{HTML}{5b5f61} % - beedfe - 

\definecolor{codegreen}{rgb}{0,0.6,0}
\definecolor{codegray}{rgb}{0.5,0.5,0.5}
\definecolor{codepurple}{rgb}{0.58,0,0.82}
\definecolor{backcolour}{HTML}{353738}

\definecolor{funcBlue}{HTML}{020046}
\definecolor{funcCyan}{HTML}{11899a}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%           Packages commands           %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\hypersetup{
    colorlinks=true,
    allcolors=linksColor}

\geometry{
    a4paper,
    total={170mm,257mm},
    left=25mm,
    right=25mm,
    top=20mm,
    bottom=25mm
    }

\renewcommand\cellgape{\Gape[8pt]}
\renewcommand{\cellalign}{cc}
\pgfplotsset{width=10cm,compat=1.9}

%\fboxrule=6pt
\fboxsep=10pt

\lstdefinestyle{mystyle}{
    backgroundcolor=\color{backcolour},   
    commentstyle=\color{codegreen},
    keywordstyle=\color{magenta},
    numberstyle=\tiny\color{codegray},
    stringstyle=\color{codepurple},
    basicstyle=\ttfamily\linespread{1.45}\footnotesize\color{white},
    breakatwhitespace=false,         
    breaklines=true,                 
    captionpos=b,                    
    keepspaces=true,                 
    numbers=left,                    
    numbersep=5pt,                  
    showspaces=false,                
    showstringspaces=false,
    showtabs=false,                  
    tabsize=2,
}

\lstset{style=mystyle}

\renewcommand{\chaptermark}[1]{%
\markboth{\thechapter.\ #1}{}}

\fancypagestyle{fancy}{%
    \fancyhf{}
    \fancyfoot[C]{\footnotesize Made by \href{https://www.leonardobiason.com}{Leonardo Biason} \copyright 2022-2023 - Please refer to the \hyperref[chap:introduction]{introduction} if you want to share this material \normalsize}
    \fancyhead[R]{\nouppercase{\rightmark}}
    \fancyhead[L]{\small Page \large \textbf{\thepage} \normalsize}
    \renewcommand{\footrulewidth}{0.4pt}% Line at the footer visible
}

\fancypagestyle{plain}{%
    \fancyhf{}
    \fancyfoot[C]{\footnotesize Made by \href{https://www.leonardobiason.com}{Leonardo Biason} \copyright 2022-2023 - Please refer to the \hyperref[chap:introduction]{introduction} if you want to share this material \normalsize}
    \fancyhead[R]{\nouppercase{\rightmark}}
    \fancyhead[L]{\small Page \large \textbf{\thepage} \normalsize}
    \renewcommand{\footrulewidth}{0.4pt}% Line at the footer visible
}

\captionsetup{justification = centering}

\titleformat{\chapter}[display]{\filright\normalfont\huge\bfseries}{Chapter \thechapter:}{0pt}{}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%             Boxes section             %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newtcolorbox{lemma}[1]{enhanced,
    boxsep=0.25ex,
    title=\textbf{\fontfamily{ppl}\selectfont{Lemma {#1}:}},
    coltitle=black,
    arc=0mm,
    rounded corners=all,
    borderline west={5pt}{-0.5pt}{theoryLINE},
    colback=lemmaBG,
    colframe=lemmaBG,
    enhanced,
    breakable,
    skin first=enhanced,
    skin middle=enhanced,
    skin last=enhanced,
    attach boxed title to top left ={
        yshift=-\tcboxedtitleheight/2,
        yshifttext=-\tcboxedtitleheight/2
    },
    halign title=left,
    boxed title style={
        colback=lemmaTitleBG,
        borderline west={5pt}{-0.5pt}{theoryLINE},
    },
    %overlay={
    %  \foreach \n in {north east,north west,south east,south west}
    %    {%
    %    \draw [theoryLINE, fill=theoryLINE] (frame.\n) circle (2pt);
    %    };
    %}
}  % DONE

\newtcolorbox{theorem}[1]{enhanced,
    boxsep=0.25ex,
    title=\fontfamily{ppl}\selectfont{\textbf{Theorem:} {#1}},
    coltitle=black,
    arc=0mm,
    rounded corners=all,
    borderline west={5pt}{-0.5pt}{theoryLINE},
    colback=theoremBG,
    colframe=theoremBG,
    enhanced,
    breakable,
    skin first=enhanced,
    skin middle=enhanced,
    skin last=enhanced,
    attach boxed title to top left ={
        yshift=-\tcboxedtitleheight/2,
        yshifttext=-\tcboxedtitleheight/2
    },
    halign title=left,
    boxed title style={%
        colback=theoremTitleBG,
        borderline west={5pt}{-0.5pt}{theoryLINE},
    },
}  % DONE

\newtcolorbox{definition}[1]{enhanced,
    boxsep=0.25ex,
    title=\fontfamily{ppl}\selectfont{\textbf{Definition:} {#1}},
    coltitle=black,
    arc=0mm,
    rounded corners=all,
    borderline west={5pt}{-0.5pt}{theoryLINE},
    colback=definitionBG,
    colframe=definitionBG,
    enhanced,
    breakable,
    skin first=enhanced,
    skin middle=enhanced,
    skin last=enhanced,
    attach boxed title to top left ={
        yshift=-\tcboxedtitleheight/2,
        yshifttext=-\tcboxedtitleheight/2
    },
    halign title=left,
    boxed title style={
        colback=definitionTitleBG,
        borderline west={5pt}{-0.5pt}{theoryLINE},
    },
}  % DONE

\newtcolorbox{proof}[1]{enhanced,
    enlarge top initially by=-6mm,
    boxsep=0.25ex,
    arc=0mm,
    title=\fontfamily{ppl}\selectfont{\textbf{Proof of the {#1}}},
    coltitle=black,
    rounded corners=all,
    borderline west={5pt}{-0.5pt}{theoryLINE},
    colback=proofBG,
    colframe=proofBG,
    enhanced,
    breakable,
    skin first=enhanced,
    skin middle=enhanced,
    skin last=enhanced,
    attach boxed title to top left ={
        yshift=-\tcboxedtitleheight/2,
        yshifttext=-\tcboxedtitleheight/2
    },
    halign title=left,
    boxed title style={
        colback=proofTitleBG,
        colframe=proofBG,
        borderline west={5pt}{-0.5pt}{theoryLINE},
    },
}  % DONE

\newtcolorbox{corollary}[1]{enhanced,
    boxsep=0.25ex,
    title=\fontfamily{ppl}\selectfont{\textbf{Corollary:} {#1}},
    coltitle=black,
    arc=0mm,
    rounded corners=all,
    borderline west={5pt}{-0.5pt}{theoryLINE},
    colback=corollaryBG,
    colframe=corollaryBG,
    enhanced,
    breakable,
    skin first=enhanced,
    skin middle=enhanced,
    skin last=enhanced,
    attach boxed title to top left ={
        yshift=-\tcboxedtitleheight/2,
        yshifttext=-\tcboxedtitleheight/2
    },
    halign title=left,
    boxed title style={%
        colback=corollaryTitleBG,
        borderline west={5pt}{-0.5pt}{theoryLINE},
    },
}  % DONE

\newtcolorbox{exercise}[1]{enhanced,
    boxsep=0.25ex,
    title=\fontfamily{ppl}\selectfont{\textbf{Exercise {#1}}},
    coltitle=black,
    arc=0mm,
    rounded corners=all,
    borderline west={5pt}{-0.5pt}{practiceLINE},
    colback=exerciseBG,
    colframe=exerciseBG,
    enhanced,
    breakable,
    skin first=enhanced,
    skin middle=enhanced,
    skin last=enhanced,
    attach boxed title to top left ={
        yshift=-\tcboxedtitleheight/2,
        yshifttext=-\tcboxedtitleheight/2
    },
    halign title=left,
    boxed title style={%
        colback=exerciseTitleBG,
        borderline west={5pt}{-0.5pt}{practiceLINE},
    },
}  % DONE

\newtcolorbox{example}[1]{enhanced,
    boxsep=0.25ex,
    title=\fontfamily{ppl}\selectfont{\textbf{Example {#1}}},
    coltitle=black,
    arc=0mm,
    rounded corners=all,
    borderline west={5pt}{-0.5pt}{practiceLINE},
    colback=exampleBG,
    colframe=exampleBG,
    enhanced,
    breakable,
    skin first=enhanced,
    skin middle=enhanced,
    skin last=enhanced,
    attach boxed title to top left ={
        yshift=-\tcboxedtitleheight/2,
        yshifttext=-\tcboxedtitleheight/2
    },
    halign title=left,
    boxed title style={%
        colback=exampleTitleBG,
        borderline west={5pt}{-0.5pt}{practiceLINE},
    },
}  % DONE

\newtcolorbox{solution}[1]{enhanced,
    enlarge top initially by=-6mm,
    boxsep=0.25ex,
    title=\fontfamily{ppl}\selectfont{\textbf{Solution to Exercise {#1}}},
    coltitle=black,
    arc=1mm,
    rounded corners=all,
    borderline west={5pt}{-0.5pt}{practiceLINE},
    colback=solutionBG,
    colframe=solutionBG,
    enhanced,
    breakable,
    skin first=enhanced,
    skin middle=enhanced,
    skin last=enhanced,
    attach boxed title to top left ={
        yshift=-\tcboxedtitleheight/2,
        yshifttext=-\tcboxedtitleheight/2
    },
    halign title=left,
    boxed title style={%
        colback=solutionTitleBG,
        borderline west={5pt}{-0.5pt}{practiceLINE},
    },
}  % DONE

\newtcolorbox{remark}[1]{enhanced,
    boxsep=0.25ex,
    title=\fontfamily{ppl}\selectfont{\textbf{Remark:} {#1}},
    coltitle=black,
    arc=0mm,
    rounded corners=all,
    borderline west={5pt}{-0.5pt}{remarkLINE},
    colback=remarkBG,
    colframe=remarkBG,
    enhanced,
    breakable,
    skin first=enhanced,
    skin middle=enhanced,
    skin last=enhanced,
    attach boxed title to top left ={
        yshift=-\tcboxedtitleheight/2,
        yshifttext=-\tcboxedtitleheight/2
    },
    halign title=left,
    boxed title style={%
        colback=remarkTitleBG,
        borderline west={5pt}{-0.5pt}{remarkLINE},
    },
}  % DONE

\newtcolorbox{curiosity}[1]{enhanced,
    boxsep=0.25ex,
    title=\fontfamily{ppl}\selectfont{\textbf{Curiosity:} {#1}},
    coltitle=black,
    arc=0mm,
    rounded corners=all,
    borderline west={5pt}{-0.5pt}{curiosityLINE},
    colback=curiosityBG,
    colframe=curiosityBG,
    enhanced,
    breakable,
    skin first=enhanced,
    skin middle=enhanced,
    skin last=enhanced,
    attach boxed title to top left ={
        yshift=-\tcboxedtitleheight/2,
        yshifttext=-\tcboxedtitleheight/2
    },
    halign title=left,
    boxed title style={%
        colback=curiosityTitleBG,
        borderline west={5pt}{-0.5pt}{curiosityLINE},
    },
}  % DONE

\newtcolorbox{codebox}[1]{enhanced,
    boxsep=0.10ex,
    title=\textbf{{#1}},
    coltitle=white,
    arc=0mm,
    rounded corners=all,
    borderline west={1pt}{-0.5pt}{codeLINE},
    borderline east={1pt}{-0.5pt}{codeLINE},
    borderline south={1pt}{-0.5pt}{codeLINE},
    borderline north={1pt}{-0.5pt}{codeLINE},
    colback=backcolour,
    colframe=backcolour,
    enhanced,
    breakable,
    skin first=enhanced,
    skin middle=enhanced,
    skin last=enhanced,
    attach boxed title to top left ={
        xshift=5pt,
        yshift=-\tcboxedtitleheight/2,
        yshifttext=-\tcboxedtitleheight/2
    },
    halign title=left,
    boxed title style={%
        colback=codeTitleBG,
    },
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%            Custom commands            %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%\newcommand{\tbold}[1]{\textbf{#1}}  % BOLD Command
\newcommand{\italic}[1]{\textit{#1}} % ITALIC Command
\newcommand{\titleFont}[1]{{\fontfamily{lato}\selectfont 
{#1}%
}}

\newcommand{\code}[1]{{\fontfamily{qcr}\selectfont 
{#1}%
}}

\newcommand*\Heq{\ensuremath{\overset{\kern2pt H}{=}}}
\newcommand*\HRightarrow{\ensuremath{\overset{\kern-13pt H}{$\Longrightarrow$}}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%           Table of contents           %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\definecolor{doc}{HTML}{6e000d} %0,60,110
\contentsmargin{0cm}
\titlecontents{chapter}[3.7pc]
{\addvspace{30pt}%
	\begin{tikzpicture}[remember picture, overlay]%
		\draw[fill=doc!90,draw=doc!90] (-7, -0.1) rectangle (-0.12, 0.5);%-0.9
        \draw[fill=white!60,draw=white!60] (-0.6, -0.15) rectangle (-0.10, 0.55);
		\pgftext[left,x=-3.5cm,y=0.2cm]{\color{white}\Large\sc\bfseries Chapter\ \color{doc}\Large\sc\bfseries \thecontentslabel};%
	\end{tikzpicture}\color{doc!90}\large\sc\bfseries}%
{}
{}
{\;\titlerule\;\large\sc\bfseries Page \thecontentspage
	\begin{tikzpicture}[remember picture, overlay]
		\draw[fill=doc!90,draw=doc!90] (2pt,0) rectangle (4,0.1pt);
	\end{tikzpicture}}%
\titlecontents{section}[3.7pc]
{\addvspace{2pt}}
{\contentslabel[\thecontentslabel]{2pc}}
{}
{\hfill\small \thecontentspage}
[]
\titlecontents*{subsection}[3.7pc]
{\addvspace{-1pt}\small}
{}
{}
{\ --- \small\thecontentspage}
[ \textbullet\ ][]

\makeatletter
\renewcommand{\tableofcontents}{%
	\chapter*{%
	  \vspace*{-20\p@}%
	  \begin{tikzpicture}[remember picture, overlay]%
		  \pgftext[right,x=15cm,y=0.2cm]{\color{doc!90}\Huge\sc\bfseries \contentsname};%
		  \draw[fill=doc!90,draw=doc!90] (13,-.75) rectangle (20,1);%
		  \clip (13,-.75) rectangle (20,1);
		  \pgftext[right,x=15cm,y=0.2cm]{\color{white}\Huge\sc\bfseries \contentsname};%
	  \end{tikzpicture}}%
	\@starttoc{toc}}
\makeatother